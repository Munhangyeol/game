# MapleQuest RPG — 개발 로드맵

## 현재 상태 (game.html 단일 파일, ~1770 lines)

- 직업 3종 (전사 / 도적 / 궁수), 직업당 기본공격 1개 + 스킬 3개
- 레벨업 시 스탯 증가: `checkLevelUp()` → `hpPerLevel / mpPerLevel / attackPerLevel`
- 몬스터 스케일링: 생성자에서 `player.level`로 HP·Damage 계산
- 스킬바 키 바인딩: A(기본공격), Z/X/C(스킬 1·2·3)

---

## 1. 전직 시스템 (Promotion)

### 1-1. 전직 단계·레벨 기준

| 단계 | 레벨 | 전사군 | 도적군 | 궁수군 |
|------|------|--------|--------|--------|
| 초기직 | 1 | 전사 | 도적 | 궁수 |
| 초변직 | 10 | 기사 | 로그 | 헌터 |
| 재변직 | 30 | 다크나이트 | 어쌔신 | 레인저 |
| 최종변직 | 70 | 히어로 | 나이트로드 | 보우마스터 |

### 1-2. 직업군별 스킬 트리

#### 전사군
| 단계 | Z (강타 계열) | X (범위 계열) | C (버프·회복 계열) |
|------|--------------|--------------|-------------------|
| 전사 | 파워 스트라이크 | 슬래시 블래스트 | 레이지 |
| 기사 | 강타+ (피해↑, 밀치기↑) | 실드 타격 (카운터 반격) | 성스러운 빛 (HP 회복 버프) |
| 다크나이트 | 다크 스트라이크 (관통 강타) | 혈의 날 (범위↑, 적 수↑) | 분노의 기사 (분노 강화·시간↑) |
| 히어로 | 영웅의 강타 (최종 강타) | 거인의 난타 (초강 범위) | 영웅의 의지 (장시간 분노) |

#### 도적군
| 단계 | Z (연속 공격 계열) | X (치명 계열) | C (속도·형질 계열) |
|------|-------------------|--------------|-------------------|
| 도적 | 삼중 스탭 | 어쌔시네이트 | 헤이스트 |
| 로그 | 사중 스탭 (히트↑) | 스텔스 백스탭 (무형화 후 강타) | 신속 (속도 강화↑) |
| 어쌔신 | 독의 스탭 (지속 피해 부여) | 치명의 일격 (치명률↑, 백스탭↑) | 그림자 이동 (순간 회피 버프) |
| 나이트로드 | 백개 단검 (극속 난무) | 영혼의 일격 (무조건 치명) | 어둠의 분신 (분신 공격 버프) |

#### 궁수군
| 단계 | Z (단발·다발 계열) | X (범위 계열) | C (특수 버프 계열) |
|------|-------------------|--------------|-------------------|
| 궁수 | 더블 샷 | 애로우 레인 | 소울 애로우 |
| 헌터 | 트리플 샷 (화살 3발) | 폭발 화살 (폭발 범위 피해) | 예리한 시선 (크리율↑ 버프) |
| 레인저 | 바람의 샷 (극속 연속 발사) | 강화 레인 (범위↑, 피해↑) | 자연의 축복 (회복+관통 복합 버프) |
| 보우마스터 | 무한의 샷 (관통+고속) | 종일 화살비 (초강 레인) | 궁수의 영혼 (최종 관통·강화) |

### 1-3. 구현 설계

```
player 객체 추가 속성
  - player.tier        : 0~3 (현재 전직 단계)
  - player.jobTier     : "warrior_0", "warrior_1" … (스킬 조회 키)

JOBS 구조 변경
  JOBS.warrior.tiers = [
    { name: '전사',        icon: '⚔️',  skills: [...] },   // tier 0
    { name: '기사',      icon: '🛡️',  skills: [...] },   // tier 1
    { name: '다크나이트',  icon: '⚔️🌑', skills: [...] },  // tier 2
    { name: '히어로',      icon: '✨⚔️', skills: [...] },  // tier 3
  ]

전직 트리거
  checkLevelUp() 내에 PROMOTION_LEVELS = [10, 30, 70] 확인
  → 해당 레벨 도달 시 showPromotionUI() 호출
  → 선택 후 player.tier++, 스킬바 갱신, jobName UI 갱신
  → 전직 축하 이펚트 (레벨업보다 강한 파티클)

스킬바 갱신
  createSkillBar()는 JOBS[player.job].tiers[player.tier].skills로 참조
```

전직은 선택지가 없음 (단일 경로). UI는 "축하" 형태의 팝업으로 충분.

---

## 2. 레벨별 스탯 성장

### 현재 구현
`checkLevelUp()`에서 직업별 고정값으로 증가:
- 전사: HP+30, MP+5, ATK+7
- 도적: HP+20, MP+8, ATK+5
- 궁수: HP+15, MP+7, ATK+8

### 강화 계획
- 크리티컬 확률: 레벨당 +0.5% 추가 증가
- 전직 시 스탯 부스: 해당 단계 기준 HP·MP 최대치를 크게 올림 (예: 초변직 시 maxHp += 50)
- 속도는 고정 유지 (직업 선택 시점에서 결정됨)

---

## 3. 몬스터 강화

### 현재 구현
생성자 내 고정 공식:
```js
slime:    { hp: 30 + level*10,  damage: 8  + level*2,  exp: 25 }
mushroom: { hp: 50 + level*15,  damage: 12 + level*3,  exp: 40 }
stump:    { hp: 80 + level*20,  damage: 15 + level*4,  exp: 60 }
```
스텀프는 Lv3+ 출현. 스폰 간격은 레벨당 100ms 감소 (최소 1000ms).

### 강화 계획
- 새 몬스터 타입 추가 (단계별 출현 조건):

| 몬스터 | 출현 레벨 | 특성 |
|--------|----------|------|
| 불타는 버그 | Lv 15+ | 불 피해 (HP회복 무효 구간) |
| 바위 고래 | Lv 35+ | 높은 HP, 하단 강타 |
| 고대 드래곤 | Lv 60+ | 강경 보스형, 고피해·고HP·폭발 공격 |

- EXP 보상도 비선형 스케일링 강화 (레벨 차이가 클수록 보상↑)
- 고레벨 몬스터 특수 공격 패턴: 현재 단순 접촉 피해만 있음 → 원거리 공격 등 추가 가능성

---

## 4. 파일 분리 (Multi-file Refactor)

### 배경
현재 game.html 단일 파일로 기능이 늘어날수록 유지보수 난易 증가.
빌드 도구 없이 유지하려면 `<script type="module">` + ESM import 사용.

### 목표 구조
```
game/
├── index.html                  # HTML 구조만 (canvas, UI 오버레이)
├── css/
│   └── style.css               # 기존 <style> 내용 전부
└── js/
    ├── state.js                # 공유 상태: game 객체, player 객체, canvas/ctx
    ├── main.js                 # 진입점: gameLoop, 키 이벤트 바인딩, import 종합
    ├── data/
    │   ├── jobs.js             # JOBS (tiers 포함) + PROMOTION_LEVELS
    │   └── monsters.js         # 몬스터 타입 정의 객체
    ├── entities/
    │   ├── monster.js          # Monster 클래스
    │   ├── projectile.js       # Projectile 클래스
    │   └── effect.js           # Effect 클래스 (모든 draw* 메서드 포함)
    ├── systems/
    │   ├── combat.js           # basicAttack, useSkill, perform* 함수 전부
    │   ├── levelup.js          # checkLevelUp, 전직 트리거·처리
    │   └── particles.js        # createParticles, createDamageText
    └── ui/
        ├── hud.js              # updateUI, updateSkillBar, updateBuffBar
        └── jobselect.js        # selectJob, 직업 선택 화면 로직
```

### 분리 순서 (단계적)
1. `css/style.css` 분리 (가장 안전)
2. `data/jobs.js`, `data/monsters.js` 분리 (순수 데이터)
3. 엔티티 클래스: `Monster`, `Projectile`, `Effect`
4. 시스템 함수: `combat.js`, `levelup.js`
5. UI 함수: `hud.js`, `jobselect.js`
6. `main.js`로 종합 import, `state.js` 공유 상태 확정

### 공유 상태 주의사항
`game`, `player`, `canvas`, `ctx`는 여러 모듈에서 참조됨.
`state.js`에서 단일 소스로 export하고, 각 모듈은 import로 사용.
전역 변수 사용 피함.

---

## 5. UI 개선

### 현재 상태
- **HUD**: 좌상단, HP·MP·EXP 바 (200×20px, 단색 그라디언트) + 공격력·크리율·처치수 텍스트만
- **스킬바**: 하단 중앙, 50×50px 슬롯, 쿨다운 중 숫자만 표시, `ready` 상태 시 초록 테두리
- **버프바**: 좌상단, 30×30px 아이콘, 남은 시간은 `title`(hover) 속성으로만 표시
- **직업 선택**: 3장 카드, 호버 시 elevate, 스킬명 텍스트만 나열 (아이콘 없음)
- **레벨업 이펚트**: 중앙 "LEVEL UP!" 텍스트 2초 animations + 황색 파티클 (스탯 증가분 표시 없음)
- **대미지 텍스트**: 캔버스 위 숫자, 일반·크리·백스탭별 색상 구분 (폰트 크기 동일)
- **컨트롤 설명**: 좌하단, 게임 중 항상 표시

### 개선 계획

#### A. HUD 강화
- HP 바: 남은 비율 ≤30%일 때 깜빡 효과 (`@keyframes` CSS animation) → 위험 상황 즉시 인식
- 스탯 행: 공격력·크리율·처치수를 아이콘 + 수치로 구조화

#### B. 스킬바·버프바 강화
- 스킬 슬롯: 쿨다운 숫자 위에 원형 진행원(`arc`) 오버레이 추가 → 남은 시간 시각 직관화
- 버프 아이콘: 남은 초를 아이콘 아래 텍스트로 항상 표시 (`title` 호버만으로는 불충분)

#### C. 직업 선택 카드 강화
- 각 직업 카드의 스킬 목록에 스킬 아이콘(emoji)을 텍스트 앞에 추가

#### D. 레벨업·전직 이펚트 강화
- 레벨업: "LEVEL UP!" 텍스트에 새 레벨 숫자를 함께 표시 (예: `LEVEL UP! Lv.10`)
- 레벨업: 스탯 증가분을 텍스트 아래로 잠깐(~1.5s) 표시
- 전직 축하: `showPromotionUI()`에서 새 직업명·아이콘·스킬 카드를 팝업으로 표시

#### E. 대미지 텍스트 강화
- 크리티컬 대미지: 폰트 크기를 일반 대미지의 1.5배로 강화
- 백스탭 대미지: 추가로 볼드체 적용

#### F. 기타
- 컨트롤 설명: 게임 시작 3초 후 페이드아웃 (항상 표시하지 않음)
- 몬스터 HP 바: `Monster` 클래스 `draw()`에 적 위상에 작은 HP 바 추가

---

## 6. Phase별 개발 단계

§1–§5의 작업을 의존관계 순으로 재배분하여 실행 체크리스트로 정리.

---

### Phase 1 — 스탯·스케일링 정비

목표: 레벨당 스탯 증가와 EXP 보상 공식을 정비하여 이후 전직·몬스터 밸런스의 기준축을 확립.

- [ ] 크리티컬 확률을 레벨당 +0.5% 증가시킴 (`checkLevelUp()` 내 직업별 고정값에 추가)
- [ ] 전직 시 스탯 부스 수치 정의 (단계별 maxHp·maxMp 상승분 확정 — 예: 초변직 maxHp += 50)
- [ ] EXP 보상을 비선형 스케일링으로 변경 (레벨 차이가 클수록 보상↑ 공식 설계 및 적용)
- [ ] HP 바 위험 구간(≤30%) 깜빡 효과 추가 (§5-A)
- [ ] 스탯 행을 아이콘+수치 형태로 구조화 (§5-A)
- [ ] 레벨업 텍스트에 새 레벨 숫자와 스탯 증가분 잠깐 표시 (§5-D)
- [ ] 크리티컬·백스탭 대미지 텍스트 폰트 크기·볼드체 강화 (§5-E)
- [ ] 직업 선택 카드 스킬 목록에 아이콘 추가 (§5-C)
- [ ] 컨트롤 설명 UI를 게임 시작 3초 후 페이드아웃으로 변경 (§5-F)

의존: 없음

---

### Phase 2 — 전직 구조 및 초변직 (Lv10)

목표: `JOBS` 구조를 tiers로 확장하고, Lv10 초변직까지의 전체 인프라와 스킬을 구현.

- [ ] `JOBS` 객체를 `tiers` 배열 구조로 변경 (warrior·thief·archer 각각 tier 0~3 배열)
- [ ] `player.tier` 속성 추가 및 초기값 0으로 설정
- [ ] `checkLevelUp()` 내에 `PROMOTION_LEVELS = [10, 30, 70]` 확인 로직과 전직 트리거 구현
- [ ] 전직 축하 팝업 UI (`showPromotionUI()`) 및 레벨업보다 강한 파티클 이펚트 구현
- [ ] 초변직 스킬 — 전사군: 강타+ (피해↑·밀치기↑), 실드 타격 (카운터 반격), 성스러운 빛 (HP 회복 버프)
- [ ] 초변직 스킬 — 도적군: 사중 스탭 (히트↑), 스텔스 백스탭 (무형화 후 강타), 신속 (속도 강화↑)
- [ ] 초변직 스킬 — 궁수군: 트리플 샷 (화살 3발), 폭발 화살 (폭발 범위 피해), 예리한 시선 (크리율↑ 버프)
- [ ] `createSkillBar()`를 `JOBS[player.job].tiers[player.tier].skills`로 참조하도록 갱신
- [ ] 스킬 슬롯에 원형 쿨다운 진행원(arc) 오버레이 추가 (§5-B)
- [ ] 버프 아이콘 아래에 남은 초 텍스트를 항상 표시 (§5-B)

의존: Phase 1 (스탯 부스 수치가 확정되어야 전직 시 적용 가능)

---

### Phase 3 — 재변직·최종변직 (Lv30·70)

목표: 전직 인프라 위에 Lv30 재변직과 Lv70 최종변직의 스킬과 이펚트를 추가.

- [ ] 재변직 스킬 (Lv30) — 전사군: 다크 스트라이크 (관통 강타), 혈의 날 (범위↑·적 수↑), 분노의 기사 (분노 강화·시간↑)
- [ ] 재변직 스킬 (Lv30) — 도적군: 독의 스탭 (지속 피해 부여), 치명의 일격 (치명률↑·백스탭↑), 그림자 이동 (순간 회피 버프)
- [ ] 재변직 스킬 (Lv30) — 궁수군: 바람의 샷 (극속 연속 발사), 강화 레인 (범위↑·피해↑), 자연의 축복 (회복+관통 복합 버프)
- [ ] 최종변직 스킬 (Lv70) — 전사군: 영웅의 강타, 거인의 난타, 영웅의 의지 / 도적군: 백개 단검, 영혼의 일격, 어둠의 분신 / 궁수군: 무한의 샷, 종일 화살비, 궁수의 영혼
- [ ] 각 단계별 이펚트 강화 (Effect 클래스에 새 타입 추가 및 draw 렌더링)
- [ ] 전체 직업·단계 조합의 밸런스 테스트 및 수치 조정

의존: Phase 2 (전직 인프라 완성 후)

---

### Phase 4 — 새 몬스터 타입

목표: 스케일링이 안정된 기준축 위에 단계별 출현 조건과 특수 공격 패턴을 가진 새 몬스터 3종을 추가.

- [ ] 불타는 버그 구현 (Lv15+ 출현, 불 피해·HP 회복 무효 구간 효과)
- [ ] 바위 고래 구현 (Lv35+ 출현, 높은 HP, 하단 강타 공격)
- [ ] 고대 드래곤 구현 (Lv60+ 출현, 강경 보스형, 고피해·고HP, 폭발 공격)
- [ ] 고레벨 몬스터 특수 공격 패턴 추가 (원거리 공격 등 접촉 피해 이외의 공격 행동)
- [ ] 몬스터 위상에 작은 HP 바 추가 (§5-F)

의존: Phase 1 (스케일링 정비 후 밸런스 기준이 안정)

---

### Phase 5 — 파일 분리

목표: 단일 파일 `game.html`을 ESM 모듈로 단계적으로 분리하여 유지보수성을 확보.

- [ ] `state.js` 생성 — `game`, `player`, `canvas`, `ctx` 공유 상태를 단일 소스로 export
- [ ] `data/jobs.js` 분리 — `JOBS` (tiers 포함) + `PROMOTION_LEVELS` 정적 데이터
- [ ] `data/monsters.js` 분리 — 몬스터 타입 정의 객체 (기존 + Phase 4 추가분)
- [ ] `entities/` 분리 — `monster.js` (Monster 클래스), `projectile.js` (Projectile 클래스), `effect.js` (Effect 클래스 및 draw* 메서드 전부)
- [ ] `systems/` 분리 — `combat.js` (basicAttack, useSkill, perform* 전부), `levelup.js` (checkLevelUp, 전직 트리거·처리), `particles.js` (createParticles, createDamageText)
- [ ] `ui/` 분리 — `hud.js` (updateUI, updateSkillBar, updateBuffBar), `jobselect.js` (selectJob, 직업 선택 화면 로직)
- [ ] `main.js` 생성 — 진입점으로 모든 모듈을 import, gameLoop과 키 이벤트 바인딩 종합 / `index.html`로 진입점 변경

의존: Phase 2~4 완료 후 (기능 추가가 끝난 후에 분리)
