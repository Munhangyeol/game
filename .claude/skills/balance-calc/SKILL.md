# 게임 밸런스 계산기

## 설명
MapleQuest RPG의 게임 밸런스를 시뮬레이션하고 계산하는 스킬입니다. 레벨별 피해, HP, 처치 시간, EXP 효율, 스킬 DPS를 분석하여 밸런스 조정에 필요한 데이터를 제공합니다.

## 사용법
```bash
/balance-calc
```

특정 영역만 계산:
```bash
/balance-calc --type=dps         # DPS 계산만
/balance-calc --type=monster     # 몬스터 밸런스만
/balance-calc --type=skill       # 스킬 밸런스만
/balance-calc --type=levelup     # 레벨업 곡선만
```

특정 레벨 기준:
```bash
/balance-calc --level=15         # Lv15 기준 계산
/balance-calc --level=1,10,30    # 여러 레벨 비교
```

## 동작 과정

1. **현재 데이터 수집**
   - game.html에서 스탯 공식 추출
   - JOBS 정의 읽기
   - 몬스터 데이터 수집

2. **계산 수행**
   - 레벨별 플레이어 스탯
   - 직업별 DPS
   - 스킬 DPS 및 MP 효율
   - 몬스터 처치 시간
   - EXP 효율

3. **결과 분석**
   - 밸런스 문제 식별
   - 개선 제안
   - 그래프/표 생성

4. **보고서 생성**
   - `.claude/docs/balance-report.md` 저장
   - 주요 지표 요약
   - 조정 권장사항

## 계산 항목

### 1. 플레이어 스탯 (레벨별)

```
레벨 1, 5, 10, 15, 20, 30에서 각 직업의:
- maxHp
- maxMp
- attack
- critRate
- speed
```

**공식:**
```
전사:
HP = 150 + (level-1) × 30
MP = 50 + (level-1) × 5
ATK = 15 + (level-1) × 7

도적:
HP = 120 + (level-1) × 20
MP = 60 + (level-1) × 8
ATK = 12 + (level-1) × 5

궁수:
HP = 100 + (level-1) × 15
MP = 70 + (level-1) × 7
ATK = 18 + (level-1) × 8
```

### 2. DPS 계산 (직업별)

**기본공격 DPS:**
```
DPS = (damage × attack × critMultiplier) / cooldown * 60

전사:
damage = 1.4× attack
cooldown = 28프레임
critRate = 15%
DPS = (1.4 × ATK × 1.0225) / 28 × 60 ≈ ATK × 3.09

도적:
damage = 0.4× attack × 2회
cooldown = 10프레임
critRate = 25%
DPS = (0.8 × ATK × 1.125) / 10 × 60 ≈ ATK × 5.40

궁수:
damage = 1.0× attack
cooldown = 18프레임
critRate = 20%
DPS = (1.0 × ATK × 1.10) / 18 × 60 ≈ ATK × 3.67
```

**스킬 DPS:**
```
스킬 DPS = totalDamage / (cooldown / 60)
MP 효율 = totalDamage / mpCost

예시: 파워 스트라이크
damage = 2.5× attack
cooldown = 60프레임 (1초)
스킬 DPS = 2.5 × ATK / 1 = 2.5 × ATK
MP 효율 = 2.5 × ATK / 10
```

### 3. 몬스터 밸런스

**처치 시간:**
```
killTime = monsterHp / playerDps

예시: Lv10 전사 vs Lv10 슬라임
playerDps = 78 × 3.09 ≈ 241
monsterHp = 30 + 10×10 = 130
killTime = 130 / 241 ≈ 0.54초 (32프레임)
```

**위협도:**
```
threat = monsterDamage / maxHp

예시: Lv10 전사 vs Lv10 슬라임
monsterDamage = 8 + 10×2 = 28
maxHp = 150 + 9×30 = 420
threat = 28 / 420 ≈ 6.7% (충돌당 HP 손실)
```

**EXP 효율:**
```
expPerSecond = monsterExp / killTime

예시: Lv10 슬라임
exp = 25
killTime = 0.54초
expPerSecond = 25 / 0.54 ≈ 46 exp/초
```

### 4. 레벨업 곡선

**필요 경험치:**
```
expToNext = 100 + (level-1) × 50

Lv1→2: 100
Lv5→6: 300
Lv10→11: 550
Lv15→16: 800
```

**몬스터 처치 수:**
```
killsNeeded = expToNext / avgMonsterExp

예시: Lv10→11 (전사)
expToNext = 550
avgMonsterExp = (25 + 40 + 60) / 3 ≈ 42
killsNeeded = 550 / 42 ≈ 13마리
```

### 5. 스킬 효율 비교

**직업별 스킬 DPS 순위:**
```
전사:
1. 파워 스트라이크: 2.5× / 1초 = 2.5× DPS
2. 슬래시 블래스트: 1.8× / 1.5초 = 1.2× DPS
3. 레이지 버프: 1.5배 공격력 10초 = 평균 +50% DPS

도적:
1. 어쌔시네이트: 2.0× / 1.3초 = 1.54× DPS (백스탭)
2. 삼중 스탭: 1.0×3 / 1.2초 = 2.5× DPS
3. 헤이스트 버프: 1.5배 공격 빈도 10초 = 평균 +50% DPS

궁수:
1. 더블 샷: 1.0×2 / 1.0초 = 2.0× DPS
2. 애로우 레인: 1.2×다수 / 2.0초 = 변동
3. 소울 애로우 버프: 관통 + 10초 = 다적 상황 +100%
```

## 출력 예시

### 예시 1: 전체 밸런스 계산
```bash
/balance-calc
```

**결과:**
```
=== MapleQuest RPG 밸런스 리포트 ===
생성 일시: 2026-02-07 12:30

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 플레이어 스탯 (주요 레벨)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

| 직업 | Lv | HP  | MP  | ATK | DPS  |
|------|-------|-----|-----|-----|------|
| 전사 | 1   | 150 | 50  | 15  | 46.4 |
| 전사 | 10  | 420 | 95  | 78  | 241  |
| 전사 | 20  | 720 | 145 | 148 | 457  |
| 도적 | 1   | 120 | 60  | 12  | 64.8 |
| 도적 | 10  | 300 | 132 | 57  | 308  |
| 도적 | 20  | 480 | 212 | 107 | 578  |
| 궁수 | 1   | 100 | 70  | 18  | 66.1 |
| 궁수 | 10  | 235 | 133 | 90  | 330  |
| 궁수 | 20  | 385 | 203 | 170 | 624  |

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
2. 몬스터 밸런스 (Lv10 기준)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

| 몬스터  | HP  | 피해 | 처치시간(전사) | 위협도 | EXP | EXP/초 |
|---------|-----|------|---------------|--------|-----|--------|
| 슬라임  | 130 | 28   | 0.54초        | 6.7%   | 25  | 46     |
| 머쉬룸  | 200 | 42   | 0.83초        | 10.0%  | 40  | 48     |
| 스텀프  | 280 | 55   | 1.16초        | 13.1%  | 60  | 52     |

⚠️ 문제점:
- 슬라임 처치시간이 너무 짧음 (0.5초) → 단조로움
- 위협도가 너무 낮음 (1회 충돌 10% 미만) → 긴장감 부족

✅ 권장사항:
- 기본 몬스터 HP 1.5배 증가
- 피해 20~30% 증가
- 고레벨 몬스터 추가 (Lv15+ 불타는 버그 등)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
3. 스킬 DPS & MP 효율 (Lv10 기준)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

전사 (ATK 78):
  기본공격 DPS: 241
  파워 스트라이크: DPS 195, MP효율 19.5, 우선도 ★★★★☆
  슬래시 블래스트: DPS 93,  MP효율 11.7, 우선도 ★★★☆☆
  레이지 버프:     +50% DPS, MP효율 높음, 우선도 ★★★★★

도적 (ATK 57):
  기본공격 DPS: 308
  삼중 스탭:       DPS 142, MP효율 17.1, 우선도 ★★★★☆
  어쌔시네이트:    DPS 88,  MP효율 11.4, 우선도 ★★★☆☆
  헤이스트 버프:   +50% DPS, MP효율 높음, 우선도 ★★★★★

궁수 (ATK 90):
  기본공격 DPS: 330
  더블 샷:         DPS 180, MP효율 18.0, 우선도 ★★★★☆
  애로우 레인:     DPS 가변, MP효율 높음, 우선도 ★★★★★
  소울 애로우:     다적 DPS↑, MP효율 높음, 우선도 ★★★★★

⚠️ 문제점:
- 버프 스킬이 너무 강력함 (상시 +50% DPS)
- 공격 스킬의 MP 효율이 비슷함 → 차별화 부족

✅ 권장사항:
- 버프 지속시간 10초 → 7초로 감소
- 또는 버프 효과 1.5배 → 1.3배로 조정
- 스킬 간 DPS/MP 효율 차별화

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
4. 레벨업 곡선
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

| 레벨    | 필요 EXP | 누적 EXP | 평균 처치수 | 예상 시간 |
|---------|----------|----------|------------|-----------|
| 1→2   | 100      | 100      | 4마리      | 2분       |
| 5→6   | 300      | 1100     | 7마리      | 4분       |
| 10→11 | 550      | 3600     | 13마리     | 8분       |
| 15→16 | 800      | 7100     | 12마리     | 7분       |
| 20→21 | 1050     | 11650    | 15마리     | 10분      |

✅ 평가: 레벨업 곡선 적절 (초반 빠름, 중후반 안정)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
5. 직업 밸런스 비교 (Lv10 기준)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

| 직업 | DPS  | HP  | 생존력 | 기동성 | 종합 |
|------|------|-----|--------|--------|------|
| 전사 | 241  | 420 | ★★★☆☆ | ★★☆☆☆ | ★★★☆☆ |
| 도적 | 308  | 300 | ★★☆☆☆ | ★★★★★ | ★★★★☆ |
| 궁수 | 330  | 235 | ★☆☆☆☆ | ★★★☆☆ | ★★★☆☆ |

⚠️ 문제점:
- 도적이 DPS, 기동성 모두 우수 → 전사/궁수 매력 부족
- 전사의 생존력 이점이 크지 않음 (HP 40% 높지만 DPS 30% 낮음)

✅ 권장사항:
- 전사: 방어 스킬 추가 (방어 자세 등)
- 궁수: 원거리 이점 강화 (안전 거리 확보)
- 도적: DPS 약간 하향 또는 HP 더 낮춤

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
6. 핵심 권장사항
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

우선순위 ★★★★★ (즉시 조정 필요):
1. 몬스터 HP 1.5배 증가 (처치 시간 확보)
2. 버프 스킬 효과/지속시간 조정 (밸런스)
3. 전사 방어 스킬 추가 (생존력 차별화)

우선순위 ★★★★☆ (개선 권장):
4. 고레벨 몬스터 추가 (다양성)
5. 스킬 MP 효율 차별화 (선택의 재미)

우선순위 ★★★☆☆ (장기 개선):
6. 전직 시스템 구현 (성장 곡선)
7. 특수 몬스터 행동 패턴 (전략성)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

상세 리포트: .claude/docs/balance-report.md에 저장됨
```

### 예시 2: 특정 레벨 DPS 계산
```bash
/balance-calc --type=dps --level=1,10,20
```

**결과:**
```
=== DPS 계산 (레벨 1, 10, 20) ===

직업별 기본공격 DPS:

Lv1:
- 전사: 46.4 (1.4×15 / 28프레임)
- 도적: 64.8 (0.8×12 / 10프레임)
- 궁수: 66.1 (1.0×18 / 18프레임)

Lv10:
- 전사: 241 (1.4×78 / 28프레임)
- 도적: 308 (0.8×57 / 10프레임)
- 궁수: 330 (1.0×90 / 18프레임)

Lv20:
- 전사: 457 (1.4×148 / 28프레임)
- 도적: 578 (0.8×107 / 10프레임)
- 궁수: 624 (1.0×170 / 18프레임)

DPS 성장 곡선:
전사: 선형 (ATK × 3.09)
도적: 선형 (ATK × 5.40) ← 가장 높음
궁수: 선형 (ATK × 3.67)
```

### 예시 3: 스킬 효율 비교
```bash
/balance-calc --type=skill --level=10
```

## 보고서 형식

생성되는 `.claude/docs/balance-report.md`:

```markdown
# MapleQuest RPG 밸런스 리포트

생성: 2026-02-07 12:30
게임 버전: game.html (Phase 1 완료)

## 요약

- 전체 밸런스: ★★★☆☆ (개선 필요)
- 직업 밸런스: ★★☆☆☆ (도적 우세)
- 몬스터 난이도: ★★☆☆☆ (너무 쉬움)
- 레벨업 곡선: ★★★★☆ (양호)

## 상세 데이터

[... 계산 결과 ...]

## 조정 권장사항

### 즉시 적용 (Phase 1)
1. 몬스터 HP × 1.5
2. 버프 지속시간 10초 → 7초

### 단기 적용 (Phase 2~3)
3. 전사 방어 스킬 추가
4. 고레벨 몬스터 3종 추가

### 장기 계획 (Phase 4~5)
5. 전직 시스템으로 밸런스 재조정
6. 특수 몬스터 행동 패턴
```

## 주의사항

1. **실제 플레이 테스트 필수**
   - 계산은 이론적 근거 제공
   - 실제 체감은 플레이로 확인

2. **크리티컬 확률 변동**
   - 평균 DPS 계산에 반영
   - 실제는 랜덤 요소로 변동

3. **AoE 스킬 변수**
   - 적 수에 따라 효율 크게 달라짐
   - 단일/다수 상황 구분 필요

4. **버프 효과**
   - 상시 유지 불가능
   - 평균 효과는 (지속시간 / 쿨다운) 비율

5. **밸런스는 지속 조정**
   - 한 번에 완벽한 밸런스 불가능
   - 지속적인 테스트와 조정 필요

## 관련 명령어

- `/game-test` - 실제 플레이 테스트
- `/add-character-skill` - 스킬 추가 (밸런스 고려)
- `/add-monster` - 몬스터 추가 (밸런스 고려)
- `/git-auto` - 밸런스 조정 커밋

## 계산 공식 참고

### DPS 계산
```
기본공격 DPS = (damage × attack × critMultiplier) / (cooldown / 60)

critMultiplier = 1 + (critRate × 0.5)
예: critRate 20% → 1 + (0.2 × 0.5) = 1.10
```

### 처치 시간
```
killTime(초) = monsterHp / playerDps
killTime(프레임) = killTime(초) × 60
```

### 위협도
```
threat = monsterDamage / playerMaxHp
충돌 1회당 HP 손실 비율
```

### EXP 효율
```
expPerSecond = monsterExp / killTime
expToKill = expNeeded / avgExp (레벨업당 처치수)
```

## 트러블슈팅

### 계산 결과가 이상함
```bash
# game.html의 공식 확인
# JOBS 정의 확인
# 수동 계산으로 검증
```

### 보고서 생성 안됨
```bash
# .claude/docs/ 디렉토리 존재 확인
mkdir -p .claude/docs

# 권한 확인
ls -la .claude/docs
```
