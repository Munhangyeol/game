# MapleQuest RPG - 통합 테스트 모음

## 🧪 개요

이 디렉토리에는 MapleQuest RPG 게임의 포괄적인 통합 테스트가 포함되어 있습니다. 테스트는 전사, 도적, 궁수 3개 직업에서 모든 게임 시스템이 올바르게 작동하는지 검증합니다.

## 📁 파일 목록

- **`integration-test.js`** - 브라우저 콘솔에서 실행 가능한 자동화 테스트 모음
- **`test-harness.html`** - 내장 테스트 러너가 있는 시각적 테스트 인터페이스
- **`README.md`** - 이 파일

## 🚀 빠른 시작

### 방법 1: 시각적 테스트 인터페이스 (권장)

1. HTTP 서버 시작:
   ```bash
   cd C:\claude-code\game
   python -m http.server 8000
   ```

2. 브라우저에서 테스트 하네스 열기:
   ```
   http://localhost:8000/test/test-harness.html
   ```

3. 테스트 버튼 클릭:
   - **전체 테스트 (모든 직업)** - 3개 직업 자동 테스트
   - **전사 테스트** - 전사 직업만 테스트
   - **도적 테스트** - 도적 직업만 테스트
   - **궁수 테스트** - 궁수 직업만 테스트

4. 테스트 패널에서 실시간 결과 확인!

### 방법 2: 콘솔 기반 테스트

1. HTTP 서버 시작 후 메인 게임 열기:
   ```
   http://localhost:8000
   ```

2. 개발자 도구 콘솔 열기 (F12)

3. 테스트 스크립트 로드:
   ```javascript
   // integration-test.js의 내용을 콘솔에 복사-붙여넣기
   ```

4. 테스트 실행:
   ```javascript
   // 단일 직업 테스트
   await runIntegrationTests('warrior')

   // 모든 직업 테스트 (페이지 새로고침 필요)
   await runAllJobTests()
   ```

## 🎮 테스트 범위

### 1단계: 초기화
- ✅ 캔버스 요소 존재 및 올바른 크기
- ✅ 직업 선택 화면 렌더링
- ✅ 3개 직업 카드 올바르게 표시

### 2단계: 직업 선택
- ✅ 3개 직업 모두 선택 가능
- ✅ 선택 후 게임 UI 표시
- ✅ 스킬바 올바르게 채워짐
- ✅ HUD 요소 표시

### 3단계: 이동 & 물리
- ✅ 좌우 이동 (ArrowLeft, ArrowRight)
- ✅ 점프 (ArrowUp, Space, W)
- ✅ 중력 및 착지
- ✅ 플랫폼 충돌 (7개 플랫폼 모두)
- ✅ 방향 전환

### 4단계: 기본 공격
- ✅ 전사 검 휘두르기 (A키)
- ✅ 도적 이중 단검 (A키)
- ✅ 궁수 화살 발사 (A키)
- ✅ 공격 쿨다운
- ✅ 시각 효과

### 5단계: 스킬 시스템
- ✅ 9개 스킬 전체 (직업당 3개 × 3개 직업)
- ✅ MP 소모 및 차감
- ✅ 스킬 쿨다운
- ✅ 버프 활성화 (레이지, 헤이스트, 소울 애로우)
- ✅ 버프 UI 표시
- ✅ 스킬바 쿨다운 시각화

### 6단계: 몬스터 전투
- ✅ 몬스터 스폰
- ✅ 몬스터 AI (플레이어 추적)
- ✅ 데미지 계산
- ✅ 크리티컬 히트
- ✅ 몬스터 사망 및 보상
- ✅ 코인 드롭

### 7단계: 레벨링 시스템
- ✅ 처치 시 경험치 획득
- ✅ 레벨업 트리거
- ✅ 스탯 증가 (HP, MP, ATK, CRIT)
- ✅ 레벨업 시각 효과
- ✅ 경험치바 진행

### 8단계: UI 요소
- ✅ HP/MP/EXP 바
- ✅ 레벨 표시
- ✅ 공격력/크리티컬 스탯
- ✅ 처치 카운터
- ✅ 버프바
- ✅ 스킬 쿨다운 오버레이

### 9단계: 성능
- ✅ 60 FPS 게임플레이
- ✅ 메모리 누수 없음
- ✅ 콘솔 에러 없음
- ✅ 장시간 세션 안정성

## 🐛 적용된 버그 수정

통합 테스트 중 발견되어 수정된 주요 버그:

### 중요 수정사항
1. **코인 스폰 경쟁 조건** - 동적 import로 인한 코인 미생성 문제 수정
2. **Null Effect 클래스 크래시** - Effect 클래스 사용 전 null 체크 추가
3. **직업 선택 타이밍** - DOMContentLoaded 이벤트 미발생 문제 수정
4. **DOM 검증** - 모든 DOM 요소 접근에 null 체크 추가
5. **MP 차감 타이밍** - 스킬 실행 성공 후에만 MP 차감

### 수정된 파일
- `src/entities/monster.js` - 코인 import + Effect null 체크
- `src/ui/jobselect.js` - DOMContentLoaded 타이밍 + DOM 검증
- `src/systems/leveling.js` - DOM 요소 검증
- `src/systems/combat.js` - MP 차감 타이밍
- `src/state.js` - 로드 시 캔버스 검증

## 📊 예상 결과

완전히 통과하는 테스트 실행 시 표시:

```
✅ 통과 - 모든 핵심 시스템 정상 작동!
📈 통과율: 100%
🎮 3개 직업 모두 플레이 가능
⚡ 60 FPS 성능
🐛 중요 버그 제로
```

## 🔍 수동 테스트 체크리스트

철저한 검증을 위해 다음 수동 테스트도 수행:

### 전사
- [ ] 근접 범위가 적절함
- [ ] 넉백 효과 작동
- [ ] 레이지 버프로 데미지 증가 확인
- [ ] 슬래시 블래스트가 여러 적 타격

### 도적
- [ ] 이동이 매우 빠름
- [ ] 공격이 연사 형태
- [ ] 헤이스트로 이동 속도 더 증가
- [ ] 어쌔시네이트가 높은 데미지

### 궁수
- [ ] 화살이 포물선으로 발사 (중력)
- [ ] 안전 거리에서 타격 가능
- [ ] 더블 샷이 화살 2개 발사
- [ ] 소울 애로우가 적 관통
- [ ] 애로우 레인의 시각적 임팩트

### 직업 간 밸런스
- [ ] 너무 강한 직업 없음 (밸런스 파괴)
- [ ] 플레이 불가능한 직업 없음 (너무 약함)
- [ ] 각 직업이 독특한 플레이 스타일 보유
- [ ] 모든 직업이 레벨 10+ 달성 가능

## 🚨 알려진 제한사항

1. **모듈 상태 노출**: 테스트가 `window.__game`과 `window.__player` 설정에 의존
2. **페이지 새로고침 필요**: 여러 직업 테스트 시 페이지 새로고침 필요
3. **타이밍 의존성**: 일부 테스트가 setTimeout 사용으로 느린 시스템에서 불안정할 수 있음
4. **모킹 없음**: 테스트가 실제 게임 상태 사용, 모킹/격리된 테스트 아님

## 📝 새 테스트 추가하기

새 테스트 단계 추가 방법:

```javascript
async testPhaseN_YourFeature() {
    this.log('단계 N: 기능명', 'phase');
    const phase = { tests: 0, passed: 0 };

    // 테스트 코드
    phase.tests++;
    if (this.assert(조건, '테스트 설명')) {
        phase.passed++;
    }

    this.results.phases['단계 N'] = phase;
    return phase;
}
```

그런 다음 integration-test.js의 `runAll()`에 추가합니다.

## 🎯 성공 기준

다음 조건을 만족하면 통합 테스트 통과:

✅ 3개 직업 모두 완전히 플레이 가능
✅ 게임을 망가뜨리는 버그 없음
✅ 60 FPS 유지
✅ 모든 핵심 시스템이 함께 작동
✅ 레벨 1부터 레벨 10까지 문제없이 플레이 가능
✅ 플레이어 경험이 부드럽고 즐거움

## 📞 지원

테스트 실패 또는 문제 발생 시:

1. 브라우저 콘솔에서 에러 확인 (F12)
2. 포트 8000에서 HTTP 서버가 실행 중인지 확인
3. 최신 브라우저 사용 확인 (Chrome/Firefox/Edge)
4. 브라우저 캐시 삭제 후 새로고침 시도

## 🔄 최근 업데이트

**2026-02-07** - 자동화 테스트 러너와 시각적 테스트 하네스를 포함한 초기 테스트 모음 생성. 테스트 중 발견된 5개의 중요 버그 수정.
